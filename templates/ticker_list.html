<!DOCTYPE html>
<html>
<head>
    <title>Input Page</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Data Input</h1>

    <label for="currency1">Currency 1:</label>
    <select id="currency1">
        <!-- Options for currency 1 will be populated dynamically -->
    </select>

    <label for="currency2">Currency 2:</label>
    <select id="currency2">
        <!-- Options for currency 2 will be populated dynamically -->
    </select>

    <label for="ticker">Ticker:</label>
    <input type="text" id="ticker" placeholder="Enter ticker here">

    <button onclick="submitData()">Submit</button>

    <h1>Ticker Data from PostgreSQL Database</h1>
    <table>
        <thead>
            <tr>
                <th>Currency 1</th>
                <th>Currency 2</th>
                <th>Ticker</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="data-table">
            <!-- Data will be dynamically updated here -->
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            $.ajax({
                url: '/currency_data',
                type: 'GET',
                success: function(response) {
                    populateDropdown('currency1', response.data);
                    populateDropdown('currency2', response.data);
                },
                error: function(error) {
                    console.error('Error fetching currency values:', error);
                }
            });
        });

        function populateDropdown(elementId, data) {
            var dropdown = document.getElementById(elementId);
            data.forEach(function(item) {
                var option = document.createElement('option');
                option.value = item[1];
                option.textContent = item[1];
                dropdown.appendChild(option);
            });
        }

        function submitData() {
            var currency1 = document.getElementById('currency1').value;
            var currency2 = document.getElementById('currency2').value;
            var additionalInfo = document.getElementById('text-input').value;

            console.log('Currency 1:', currency1);
            console.log('Currency 2:', currency2);
            console.log('Additional Info:', additionalInfo);
        }

        function fetchData() {
            $.ajax({
                url: '/ticker_data',
                type: 'GET',
                success: function(response) {
                    console.log('Received data:', response.data);
                    updateUI(response.data);
                },
                error: function(error) {
                    console.error('Error fetching data:', error);
                }
            });
        }

        function updateUI(data) {
            $('#data-table').empty();

            data.forEach(function(item) {
                $('#data-table').append(`
                    <tr>
                        <td>${item[0]}</td>
                        <td>${item[1]}</td>
                        <td>${item[2]}</td>
                        <td>
                            <button onclick="editRow('${item[2]}')">Edit</button>
                            <button onclick="deleteRow('${item[2]}')">Delete</button>
                        </td>
                    </tr>
                `);
            });
        }

        function editRow(ticker) {
            console.log('Edit button clicked for ticker:', ticker);
            // Implement your edit logic here
        }

        function deleteRow(ticker) {
            console.log('Delete button clicked for ticker:', ticker);
            var data = {
                'data': ticker
            };
            $.ajax({
                url: '/ticker_delete',
                type: 'POST',
                contentType: 'application/json', // Set content type to JSON
                data: JSON.stringify(data), // Send data as JSON
                success: function(response) {
                    console.log('Row deleted successfully');
                    fetchData(); // Refresh data after deletion
                },
                error: function(error) {
                    console.error('Error deleting row:', error);
                }
            });
        }

        $(document).ready(function() {
            fetchData();
        });


        function submitData() {
            var currency1 = document.getElementById('currency1').value;
            var currency2 = document.getElementById('currency2').value;
            var ticker = document.getElementById('ticker').value;

            // Prepare data to send to the backend
            var data = {
                'currency1': currency1,
                'currency2': currency2,
                'ticker': ticker
            };

            // Send data to the backend using AJAX
            $.ajax({
                url: '/ticker_post', // Endpoint to submit data to Flask
                type: 'POST',
                contentType: 'application/json', // Set content type to JSON
                data: JSON.stringify(data), // Send data as JSON
                success: function(response) {
                    console.log('Data submitted successfully:', response.message);
                    fetchData(); // Refresh data after successful submission
                },
                error: function(error) {
                    console.error('Error submitting data:', error.responseJSON.error);
                }
            });
        }
    </script>
</body>
</html>
